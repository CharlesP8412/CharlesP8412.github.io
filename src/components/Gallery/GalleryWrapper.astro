---
import { getCollection } from 'astro:content';
import Gallery from './Gallery';

// Load projects from content collection
const projectEntries = await getCollection('projects');
const projects = projectEntries
  .map((entry) => ({
    id: entry.data.id,
    title: entry.data.title,
    description: entry.data.description,
    thumbnail: entry.data.thumbnail,
    image: entry.data.image,
    gitHubLink: entry.data.gitHubLink,
    demoLink: entry.data.demoLink,
    stack: entry.data.stack,
    features: entry.data.features,
    order: entry.data.order,
    content: entry.body,
  }))
  .sort((a, b) => a.order - b.order);

// Load tech stack from content collection
const techStackEntries = await getCollection('techStack');
const techStackMap = new Map(
  techStackEntries.map((entry) => [entry.data.name, { name: entry.data.name, icon: entry.data.icon }]),
);

// Convert Map to array of objects for passing to React
const techStackArray = Array.from(techStackMap.entries()).map(([key, value]) => ({
  key,
  value,
}));
---

<Gallery client:load projects={projects} techStackData={techStackArray} />
